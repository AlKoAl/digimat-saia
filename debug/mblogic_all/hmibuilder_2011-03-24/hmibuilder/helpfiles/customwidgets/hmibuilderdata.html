<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN" 
	"http://www.w3.org/TR/html4/strict.dtd">
<html>

<head>
	<meta http-equiv="Content-Type" content="text/html;charset=utf-8" >

	<title>Help - HMI - HMIBuilder Data</title>
<link rel="icon" type="image/png" href="/systemicon.png">
<!-- General page layout style sheet. -->
<link rel="stylesheet" href="/helppagelayout.css" type="text/css">
</head>

<body>
<div id="filler">

	<div id="header">
		<p class="headlogo">
			<img src="/systemlogo.png" width="200" alt="MB Logic Logo"/>
			<span class="headtitle1">MBLogic </span>
			<span class="headtitle2"> for an open world in automation</span>
		</p>
	</div>



	<!-- This is the standard nav bar. -->
	<div id="nav">
		<ul>
			<li><a href="/index.html">Home</a></li>
			<li><a href="/svgedit/svgedit.html">Edit SVG</a></li>
			<li><a href="/svglib/svglib.html">SVG Library</a></li>
			<li><a href="/svglibedit/svglibedit.html">Inkscape</a></li>
			<li><a href="/hmitemplates/hmitemplates.html">Templates</a></li>
			<li><a href="/hmibuilder/hmibuilder.html">Assemble Page</a></li>
		</ul>
	</div>


<hr>

	<!-- This is the help system nav bar. -->
	<div id="helpnav">
		<h2>Help Topics</h2>
		<ul>
			<li><a href="/index.html">Home</a></li>
			<li><a href="/svgedit/svgedit.html">Editing SVG with Inkscape</a></li>
			<li><a href="/svglib/svglib.html">SVG Library</a></li>
			<li><a href="/svglibedit/svglibedit.html">Using the SVG Library with Inkscape</a></li>
			<li><a href="/customwidgets/customwidgets.html">Custom Widgets</a></li>
			<li><a href="/hmitemplates/hmitemplates.html">HMI web templates</a></li>
			<li><a href="/hmibuilder/hmibuilder.html">Assembling web pages</a></li>
			<li><a href="/hmilib/hmilib.html">HMI Javascript Client Libraries</a></li>
			<li><a href="/basicconcepts/basicconcepts.html">Basic Concepts</a></li>
			<li><a href="/manualpage/manualpage.html">Manual HMI Web Page Construction</a></li>
		</ul>

		<h3>Creating Custom Widgets</h3>
		<ul>
			<li><a href="/customwidgets/widgetbasics.html">Widget Basics</a></li>
			<li><a href="/customwidgets/passivewidget.html">Passive Widget</a></li>
			<li><a href="/customwidgets/hmibuilderdata.html">HMIBuilder Data</a></li>
			<li><a href="/customwidgets/activewidget.html">Active Widgets</a></li>
		</ul>

	</div>



	<!-- Put main content here -->
	<div id="datadisplay">


<h1>HMIBuilder Data</h1>


<h2>Overview</h2>

<p>To use the HMIBuilder program to create active widgets, HMIBuilder requires 
that certain data be included in the widget. This section describes that data.
</p>

<hr>

<h2>Example Output Widget</h2>

<h3>Complete Example</h3>

<p>The following is an example of a simple output widget. This example displays
integer digits in an SVG text element. It could be used to display numeric
data. 
</p>


<pre class="examples">

&lt;?xml version="1.0" encoding="UTF-8" standalone="no"?&gt;
&lt;svg
   xmlns:svg="http://www.w3.org/2000/svg"
   xmlns="http://www.w3.org/2000/svg"
   xmlns:mblogic="http://www.example.com/mblogic"
   version="1.0"
   width="50"
   height="20"&gt;

&lt;!-- This provides a text object. --&gt;
&lt;g mblogic:widgettype="text" 
	mblogic:widgetname="Integer Digits"
	mblogic:editcount="0"
	mblogic:menu='[{"value": "", "type": "tag", "name": "Output Tag", "param": "outputtag"}]'
	mblogic:inputfunc="[]"
	mblogic:outputfunc='MBHMIProtocol.AddToDisplayList(new MB_NumericDisplay(document, 
					"%(widgetid)s"), "%(outputtag)s", "read");'
	&gt;

	&lt;text x="50" y="20" stroke="red" fill="red" font-size="20" text-anchor="end"&gt;1234&lt;/text&gt;

&lt;/g&gt;
&lt;/svg&gt;

</pre>


<h3>Basic Artwork</h3>

<p>The following shows the basic SVG widget artwork. This is similar to the
example used for passive data, but two this should be noted. The first is that
we have provided some default data for the "text" element ("1234" in this 
case). This data will be replaced with real data when the HMI is running, but
in the mean time it provides some visible component while we are creating the
drawing. Without this, the text element would be invisible. This is something 
that must be kept under consideration with some types of SVG elements.
</p>

<p>The other point is we have enclosed the text element inside a set of "group"
tags ("&lt;g&gt;" and "&lt;/g&gt;"). Although these are not always necessary 
for the purposes of displaying simple SVG widgets, we will need this because
we will store extra data as attributes which the HMIBuilder program will use.
This means we must always provide a set of enclosing "&lt;g&gt;" and 
"&lt;/g&gt;" around our widget.
</p>

<pre class="examples">

&lt;?xml version="1.0" encoding="UTF-8" standalone="no"?&gt;
&lt;svg
   xmlns:svg="http://www.w3.org/2000/svg"
   xmlns="http://www.w3.org/2000/svg"
   version="1.0"
   width="50"
   height="20"&gt;

&lt;!-- This provides a text object. --&gt;
&lt;g&gt;

	&lt;text x="50" y="20" stroke="red" fill="red" font-size="20" text-anchor="end"&gt;1234&lt;/text&gt;

&lt;/g&gt;
&lt;/svg&gt;

</pre>


<h3>HMIBuilder Data</h3>

<p>The following shows the attribute data which has been added to the widget. This
data allows the HMIBuilder program to find the SVG widget in the SVG drawing,
identify it, construct menus, and assemble the final Javascript which will
enable it to function as an active widget. The presence of the 
'mblogic:widgettype' attribute in a "g" tag is what identifies something as an
HMI widget.
</p>

<pre class="examples">

&lt;g mblogic:widgettype="text" 
	mblogic:widgetname="Integer Digits"
	mblogic:editcount="0"
	mblogic:menu='[{"value": "", "type": "tag", "name": "Output Tag", "param": "outputtag"}]'
	mblogic:inputfunc="[]"
	mblogic:outputfunc='MBHMIProtocol.AddToDisplayList(new MB_NumericDisplay(document, 
					"%(widgetid)s"), "%(outputtag)s", "read");' &gt;

&lt;/g&gt;

</pre>

<h3>XML Name Space</h3>

<p>There is an addition step which must be taken. The SVG definition heading 
must have the 'mblogic' <em>name space</em> added to it. 
</p>

<pre class="examples">

&lt;svg
   xmlns:svg="http://www.w3.org/2000/svg"
   xmlns="http://www.w3.org/2000/svg"
   <strong>xmlns:mblogic="http://www.example.com/mblogic"</strong>
   version="1.0"
   width="50"
   height="20"&gt;

</pre>

<hr>

<h2>HMIBuilder Data</h2>

<p>The HMIBuilder program requires special data to be inserted into the
widget file to be able to work with it. This data is stored in the form of 
<em>attributes</em>. An attribute is additional data or annotations added to 
a tag. These attributes must be in the "g" (or <em>group</em>) tag which
encloses the widget (the same one you add the identifying "id" to). The data 
consists of the following components. 
</p>


<h3>Basic Data</h3>

<p>The basic data constitutes parameters that indentify the type of widget,
and control the editing process:
</p>

<ul>
	<li><strong>mblogic:widgettype:</strong> The presence of this attribute
		identifies this to HMIBuilder as an SVG HMI widget. The value is unused 
		at present, but may be used in future.
	</li>

	<li><strong>mblogic:widgetname:</strong> This name will appear in the widget menu
		when you edit the widget. The actual name does not matter as it is simply
		displayed. However, you should use a name which is recognisable and which
		does not conflict with other widgets.
	</li>

	<li><strong>mblogic:editcount:</strong> This is used by HMIBuilder to determine
		whether the widget has been edited yet. If the edit count is 0, it is
		assumed to have not been edited yet (and so requires configuration). If
		the value is not 0, it is assumed it has been edited. This value is saved
		in the HMI drawing when you save your changes so that if you edit a 
		drawing over several sessions, it will remember which widgets have been
		configured and which have not. The <em>editcount</em> in a widget file
		(as opposed to an HMI drawing) must <strong>always be set to 0</strong>.
		If it is not 0, the HMIBuilder program will assume that it has already
		been edited and has valid parameters.
	</li>

</ul>


<pre class="examples">

	mblogic:widgettype="text" 
	mblogic:widgetname="Integer Digits"
	mblogic:editcount="0"

</pre>

<h3>Menu Data</h3>

<p>The menu data is used to construct the menus which appear in the parameter 
menu which appears in HMIBuilder. The menu data is encoded as JSON data which
is embedded in the attribute string. The web page will merely see this as a 
string, but HMIBuilder will attempt to convert the string into actual data. 
</p>

<p>The JSON data must be an array (list) of objects, with each array element
representing one menu entry. Each objects must have certain attributes. 
These are:
</p>

<ul>
	<li><strong>name</strong> - The name of the parameter. This name will
		appear on the menu when you edit the parameter. </li>
	<li><strong>type</strong> - The expected data type.</li>
	<li><strong>value</strong> - The data value. Default data may be created by
		inserting it here. When the SVG drawing is saved, the current value 
		(entered by the user will be stored here. </li>
	<li><strong>param</strong> - The name used to help substitute the data into
		the input or output functions. This will be described in more detail 
		below. However, this name must be unique within each widget (although
		other widgets may use the same name). </li>
</ul>


<p>The <strong><em>widgetid</em></strong> param is automatically defined by 
HMIBuilder in order to make the <em>id</em> attribute available, so you do 
not have to create this in your menu. 
</p>


<p>The valid types are:
</p>

<ul>
	<li><strong>tag</strong> - An address tag. This will appear as an option 
		menu list. The list will be derived from the selected HMI 
		configuration file.
	</li>
	<li><strong>int</strong> - A valid integer. 
	</li>
	<li><strong>float</strong> - A valid floating point number.
	</li>
	<li><strong>str</strong> - A valid string.
	</li>
	<li><strong>textlist</strong> - A comma separated list of values.
	</li>
	<li><strong>colour</strong> - A colour. This will appear as an option 
		menu list.
	</li>
	<li><strong>layer</strong> - An drawing layer name. This will appear as an 
		option menu list. This will be derived from the layers found in the 
		drawing.
	</li>
	<li><strong>none</strong> - A special type used to indicate an empty
		menu. This is used when a widget requires no parameters. </li>
</ul>

<p>When the HMI drawing is saved, the selected parameters will be saved with
the parameter.
</p>

<pre class="examples">

	mblogic:menu='[{"value": "", "type": "tag", "name": "Output Tag", "param": "outputtag"}]'

</pre>



<h3>Output Functions</h3>

<p>The output function attribute is used to construct the Javascript code 
which is used to control "output" devices. Output devices are those which 
display data read from the server.
</p>

<p>The output function attribute data is a string which contains the Javascript
code which will be inserted into the HMI web page. This string may contain 
multiple lines of Javascript. The string itself contains codes which are used
by HMIBuilder to find where to substitute in the menu data. 
</p>

<p>The string substitution codes have the format 
<strong>%(<em>param</em>)s</strong>, where "<em>param</em>" is the parameter value
defined in the menu. For example, for <strong>"param": "outputtag"</strong> the
code would be <strong>%(outputtag)s</strong>. 
</p>


<p>The <strong><em>widgetid</em></strong> code is automatically created by 
HMIBuilder, so do not attempt to use this as one of your own code names. You
may use the same code multiple times in the output function string if the same
value must be present several times. 
</p>

<p>Note that due to problems which will arise if you "overlap" single 
( <strong>'</strong> ) and double ( <strong>"</strong> ) quotes, you must take
care when entering quotes to use one type of quote for embedding within the
string, and another type for enclosing it. However, you can "escape" embedded 
quotes (cause them to be ignored by either preceding them with a back slash 
(e.g. <strong>\"</strong>, or representing them with the alternate HTML symbol
(e.g. <strong>&amp;quot;</strong>). This only works for embedded quotes 
however, not those used to enclose the attribute string. 
</p>

<pre class="examples">

	mblogic:outputfunc='MBHMIProtocol.AddToDisplayList(new MB_NumericDisplay(document, "%(widgetid)s"), 
			"%(outputtag)s", "read");'

</pre>


<h3>Input Functions</h3>

<p>Input functions have characteristics similar to both menus and are similar 
to output functions. Input functions are encoded as JSON embedded in an 
attribute string. They consist of arrays (lists) of objects with the following
attributes:
</p>

<ul>
	<li><strong>event</strong> - This is the event handler attribute the 
		resulting Javascript code will be attached to. </li>
	<li><strong>func</strong> - This a string containing the event handler code
		to be executed. </li>
</ul>


<pre class="examples">

	mblogic:inputfunc='[{"event": "onclick", 
	"func": "MBHMIProtocol.WriteToggleImmediate(\"%(inputtag)s\", \"%(inputtag)s\");"}]'

</pre>

<p>You can have multiple different types of event handers by adding more objects.
</p>

<hr>

<h2>Examples</h2>

<p>The following shows some typical examples of SVG widgets. These examples 
show just the SVG and attributes to implement the widgets themselves, but for 
the sake of clarity omit the additional SVG heading and colour gradient 
declarations. 
</p>

<p>You can view the actual text of the SVG widget files themselves for
complete examples.
</p>


<h3>Toggle Push Buttons</h3>

<p>This shows a simple input example. Note that the output function 
("mblogic:outputfunc") is an empty string. 
</p>

<pre class="examples">

&lt;g class="buttonactivate" 
	mblogic:widgettype="pb_toggle" 
	mblogic:widgetname="Toggle Push Button 1"
	mblogic:editcount="0"
	mblogic:menu='[{"param": "inputtag", "type": "tag", "name": "Input Tag", "value": ""}]'
	mblogic:inputfunc='[
		{"event": "onclick", 
		"func": "MBHMIProtocol.WriteToggleImmediate(\"%(inputtag)s\", \"%(inputtag)s\");"}]'
	mblogic:outputfunc=""
	&gt;

	&lt;rect x="7" y="7" width="80" height="80" rx="15" fill="grey" 
		stroke="none" stroke-width="0px" filter="url(#MB_DropShadowFilter)"/&gt;
	&lt;rect fill="url(#MB_IndigoGradient)" x="0" y="0" width="80" height="80" rx="15"/&gt;
	&lt;text x="40" y="50" font-size="24" stroke-width="2px" text-anchor="middle"&gt;PB&lt;/text&gt;

&lt;/g&gt;

</pre>

<h3>Momentary Push Buttons</h3>

<p>This shows an input with multiple event handlers. Note that there are 
multiple input event handlers defined. 
</p>

<pre class="examples">

&lt;g class="buttonactivate" 
	mblogic:widgettype="pb_momentary" 
	mblogic:widgetname="Momentary Push Button"
	mblogic:editcount="0"
	mblogic:menu='[{"param": "inputtag", "type": "tag", "name": "Input Tag", "value": ""}]'
	mblogic:inputfunc='[
		{"event": "onclick",	"func": "MBHMIProtocol.WriteImmediate(\"%(inputtag)s\", 1);"}, 
		{"event": "onmouseup", "func": "MBHMIProtocol.WriteImmediate(\"%(inputtag)s\", 0);"}, 
		{"event": "onmouseout", "func": "MBHMIProtocol.WriteImmediate(\"%(inputtag)s\", 0);"}]'
	mblogic:outputfunc=""
	&gt;

	&lt;rect x="7" y="7" width="80" height="80" rx="15" fill="grey" 
		stroke="none" stroke-width="0px" filter="url(#MB_DropShadowFilter)"/&gt;
	&lt;rect fill="url(#MB_PurpleGradient)" x="0" y="0" width="80" height="80" rx="15"/&gt;
	&lt;text x="40" y="50" font-size="24" stroke-width="2px" text-anchor="middle"&gt;PB&lt;/text&gt;

&lt;/g&gt;

</pre>

<h3>Pilot Light</h3>

<p>This shows a simple output. Note that the input function 
("mblogic:inputfunc") is an empty array (<strong><em>not</em></strong> just
an empty string). 
</p>

<pre class="examples">

&lt;g mblogic:widgettype="pilot_light" 
	mblogic:widgetname="Pilot Light"
	mblogic:editcount="0"
	mblogic:menu='[{"value": "", "type": "tag", "name": "Output Tag", "param": "outputtag"}, 
		{"value": "black", "type": "colour", "name": "Init Colour", "param": "initcolour"}, 
		{"value": "", "type": "colour", "name": "Off Colour", "param": "offcolour"}, 
		{"value": "", "type": "colour", "name": "On Colour", "param": "oncolour"}]'
	mblogic:inputfunc="[]"
	mblogic:outputfunc='MBHMIProtocol.AddToDisplayList(new MB_PilotLight(document, 
		"%(widgetid)s", "%(initcolour)s", "%(offcolour)s", "%(oncolour)s"), 
		"%(outputtag)s", "read");'
	&gt;
	&lt;!-- This is a decorative nut. --&gt;
	&lt;polygon transform="translate(5,5)" fill="grey" stroke="none"
		filter="url(#MB_DropShadowFilter)"
			points="63,0 27,0 0,27 0,63 27,90 63,90 90,63 90,27 63,0" /&gt;
	&lt;polygon  fill="url(#MB_SilverGradient)" stroke="none"
			points="63,0 27,0 0,27 0,63 27,90 63,90 90,63 90,27 63,0" /&gt;
	
	&lt;!-- This is the part which changes colour. --&gt;
	&lt;circle cx="45px" cy="45px" r="35px" stroke="black" stroke-width="5px"/&gt;

&lt;/g&gt;

</pre>


<h3>Selector Switch</h3>

<p>This shows a selector switch, which has both input and output functions.
</p>

<pre class="examples">

&lt;g mblogic:widgettype="ss2short" 
	mblogic:widgetname="2 Pos SS"
	mblogic:editcount="0"
	mblogic:menu='[
		{"type":"tag", "name":"Input Tag", "param":"inputtag", "value":""}, 
		{"type":"tag", "name":"Switch Tag", "param":"switchtag", "value":""}]'
	mblogic:inputfunc='[
		{"event": "onclick", 
		"func": "MBHMIProtocol.WriteToggleImmediate(\"%(inputtag)s\", \"%(inputtag)s\");"}]'
	mblogic:outputfunc='MBHMIProtocol.AddToDisplayList(new MB_2PosSSDisplay(document, 
		"%(widgetid)s", -60, 60), "%(switchtag)s", "read");'
	&gt;

	&lt;!-- This is a decorative nut. --&gt;
	&lt;polygon transform="translate(5,5)" fill="grey" stroke="none" filter="url(#MB_DropShadowFilter)"
		points="18,-45 -18,-45 -45,-18 -45,18 -18,45 18,45 45,18 45,-18 18,-45" /&gt;
	&lt;polygon  fill="url(#MB_SilverGradient)" stroke="none"
		points="18,-45 -18,-45 -45,-18 -45,18 -18,45 18,45 45,18 45,-18 18,-45" /&gt;
	
	&lt;g class="buttonactivate" &gt;
		&lt;!-- This forms the circular rotating inner area of the switch. --&gt;
		&lt;circle cx="0px" cy="0px" r="35px" fill="red" stroke="black" stroke-width="5px"/&gt;
	
		&lt;!-- This is the rotating actuator. --&gt;
		&lt;rect x="-8" y="-33" width="16" height="66" rx="5" fill="grey" stroke-width="2px"/&gt;
		&lt;polygon fill="white" points="0,-30 -5,-20 5,-20 0,-30" /&gt;

	&lt;/g&gt;
	
&lt;/g&gt;

</pre>


<hr>

	</div>

	<!-- Standard footer -->
	<div id="footer">
		<p>MB-HMI</p>
	</div>

</div>


</body>
</html>


<!-- Copyright 2008 - 2011. Michael Griffin 
This file is part of MBLogic. 
MBLogic is free software: you can redistribute it and/or modify 
it under the terms of the GNU General Public License as published by 
the Free Software Foundation, either version 3 of the License, or 
(at your option) any later version. 
MBLogic is distributed in the hope that it will be useful, 
but WITHOUT ANY WARRANTY; without even the implied warranty of 
MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the 
GNU General Public License for more details. 
You should have received a copy of the GNU General Public License 
along with MBLogic. If not, see <http://www.gnu.org/licenses/>. 
-->
